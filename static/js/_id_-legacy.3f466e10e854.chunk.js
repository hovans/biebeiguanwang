System.register(["./vendor-legacy.92ff5d757b54.chunk.js","./index-legacy.104de674e3dc.js","./constate.es-legacy.903b766c8c51.chunk.js","./order-legacy.246da77bf9e0.chunk.js","./plan-legacy.e3badb7c7cb5.chunk.js"],(function(e,r){"use strict";var t,a,c,n,o,d,i,l,s,u,h,m,p,b,g,f,v,k,y,N,x,_,E,M,S,I,w,D,C,L,F,A,P,Y,H,j,G,T,R,O,q,W,z,Q,U,$;return{setters:[e=>{t=e.n,a=e.a9,c=e.r,n=e.ar,o=e.j,d=e.aI,i=e.i,l=e.bA,s=e.bQ,u=e.bR,h=e.bS,m=e.ah,p=e.T,b=e.aj,g=e.bT,f=e.F,v=e.av,k=e.ai,y=e.bP,N=e.bl,x=e.bm,_=e.a7,E=e.bn,M=e.bU,S=e.bo,I=e.bh,w=e.a$,D=e.bV,C=e.H,L=e.af,F=e.p,A=e.v,P=e.as,Y=e.bL},e=>{H=e.v,j=e.w,G=e.x,T=e.M,R=e.m,O=e.t,q=e.A,W=e.y,z=e.b},e=>{Q=e.c},e=>{U=e.O},e=>{$=e.a}],execute:function(){const[r,B]=Q((({tradeNo:e})=>{const{t:r}=t(),{enqueueSnackbar:n}=a(),[o,d]=c.useState(U.PENDING),[i,l]=c.useState(!1),s=H(e),u=j(e,{skip:o!==U.PENDING&&o!==U.PAID||!s.isSuccess,pollingInterval:1e3}),h=G(void 0,{skip:o!==U.PENDING||!s.isSuccess}),[m,p]=c.useState(0),b=c.useMemo((()=>new Map(h.data?.map((e=>[e.id,e])))),[h.data]);return c.useEffect((()=>{0===m&&h.isSuccess&&p(h.data[0].id)}),[h.isSuccess,m,h.data]),c.useEffect((()=>{s.data?.status&&d(s.data.status)}),[s.data?.status]),c.useEffect((()=>{u.data&&d(u.data)}),[u.data]),c.useEffect((()=>{s.error&&n(r("notice::order-detail-error",{error:s.error.message}),{variant:"error"})}),[s.error]),{tradeNo:e,status:o,detail:s,callback:u,paymentMethod:h,paymentMethodIndex:b,paymentMethodState:m,setPaymentMethodState:p,isSubmitting:i,setSubmitting:l}})),V=()=>{const{t:e}=t(),{detail:{data:r,isLoading:a}}=B(),s=c.useMemo((()=>{const e=n.unix(r?.created_at||0);switch(r?.period){case $.MONTHLY:return e.add(1,"month");case $.QUARTERLY:return e.add(3,"month");case $.HALF_YEARLY:return e.add(6,"month");case $.YEARLY:return e.add(1,"year");case $.TWO_YEARLY:return e.add(2,"year");default:return e}}),[r?.created_at,r?.period]),u=c.useMemo((()=>[{label:e("order.checkout.product-info-card.product-name"),value:r?.plan.name},{label:e("order.checkout.product-info-card.product-type"),value:e("order.checkout.product-info-card.product-period",{context:r?.period})},{label:e("order.checkout.product-info-card.traffic"),value:e("order.checkout.product-info-card.traffic",{count:r?.plan.transfer_enable||0,context:null===r?.plan.transfer_enable?"unlimited":"limited"})},...r?.period===$.ONETIME?[]:[{label:e("order.checkout.product-info-card.next-billing-date"),value:s.format("YYYY/MM/DD")}]]),[r,e,s]);return o(T,{title:e("order.checkout.product-info-card.title"),children:o(d,{container:!0,spacing:1,children:u.map(((e,r)=>o(d,{item:!0,xs:12,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:4,children:e.label}),o(d,{item:!0,xs:8,children:a?o(l,{variant:"text",width:"100%"}):e.value})]})},r)))})})},J=R()(((e,{status:r})=>({root:{padding:e.spacing(1)},icon:{fontSize:e.spacing(8),color:e.palette[r===U.FINISHED?"success":"warning"].main}}))),K=()=>{const{t:e}=t(),{status:r}=B(),{classes:a}=J({status:r}),n=c.useMemo((()=>{switch(r){case U.FINISHED:return o(h,{className:a.icon});case U.CANCELLED:return o(u,{className:a.icon});case U.PENDING:return o(s,{className:a.icon});default:return null}}),[r]),d=c.useMemo((()=>{switch(r){case U.FINISHED:return"finished";case U.CANCELLED:return"cancelled";case U.PAID:return"paid";default:return null}}),[r]);return o(T,{className:a.root,children:o(m,{direction:"column",spacing:3,children:i(m,{direction:"column",spacing:1,alignItems:"center",children:[n,o(p,{variant:"h3",children:e("order.checkout.status-card.status",{context:d})}),o(p,{variant:"body1",color:"textSecondary",align:"center",children:e("order.checkout.status-card.description",{context:d})})]})})})},X=()=>{const{t:e}=t(),[r,{setLeft:c,setRight:n}]=b(!1),{tradeNo:d}=B(),[l]=O(),{enqueueSnackbar:s}=a(),u=g((async()=>{try{const r=await l(d).unwrap();r?(s(e("notice::order-cancel_success"),{variant:"success"}),w.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!0})):(s(e("notice::order-cancel_failed"),{variant:"error"}),w.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!1,error:r}))}catch(r){console.error("error when cancel order:",r),s(e("notice::order-cancel_failed"),{variant:"error"}),w.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!1,error:r})}c()}));return i(f,{children:[o(v,{title:e("order.checkout.order-info-card.cancel-tooltip"),placement:"top",children:o(k,{onClick:n,children:o(y,{})})}),i(N,{open:r,onClose:c,children:[o(x,{children:o(m,{direction:"row",alignItems:"center",spacing:1.5,children:o(p,{variant:"inherit",children:e("order.checkout.order-info-card.cancel-dialog.title")})})}),o(_,{}),o(E,{children:o(M,{children:e("order.checkout.order-info-card.cancel-dialog.content")})}),i(S,{children:[o(I,{onClick:c,children:e("order.checkout.order-info-card.cancel-dialog.cancel-button")}),o(I,{variant:"contained",color:"primary",onClick:u,children:e("order.checkout.order-info-card.cancel-dialog.confirm-button")})]})]})]})},Z=()=>{const{t:e}=t(),{detail:{data:r,isLoading:a},status:s}=B(),u=c.useMemo((()=>{if(a)return[];const t=(()=>{switch(s){case U.FINISHED:return"finished";case U.CANCELLED:return"cancelled";case U.PENDING:return"pending";case U.PAID:return"paid";default:return"cancelled"}})();return[{label:e("order.checkout.order-info-card.order-number"),value:r?.trade_no},{label:e("order.checkout.order-info-card.order-date"),value:n.unix(r?.created_at||0).format("YYYY-MM-DD HH:mm:ss")},{label:e("order.checkout.order-info-card.order-status"),value:e(`order.checkout.order-info-card.order-status-value_${t}`)},...r?.discount_amount?[{label:e("order.checkout.order-info-card.coupon-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.discount_amount||0)/100).toFixed(2)})}]:[],...r?.surplus_amount?[{label:e("order.checkout.order-info-card.subscription-deduct-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.surplus_amount||0)/100).toFixed(2)})}]:[],{label:e("order.checkout.order-info-card.order-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.total_amount||0)/100).toFixed(2)})}]}),[r,a,s,e]);return a?o(l,{variant:"rectangular",height:200}):o(T,{title:e("order.checkout.order-info-card.title"),secondary:s===U.PENDING&&o(X,{}),children:o(d,{container:!0,spacing:2,children:u.map(((e,r)=>o(d,{item:!0,xs:12,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:4,children:e.label}),o(d,{item:!0,xs:8,children:o(p,{variant:"body1",noWrap:!0,children:a?o(l,{variant:"text",width:"100%"}):e.value})})]})},r)))})})},ee=R()((e=>({icon:{fontSize:e.spacing(2.5)}}))),re=()=>{const{t:e}=t(),{paymentMethod:{isLoading:r},detail:{isLoading:a},paymentMethodIndex:n,paymentMethodState:d,setPaymentMethodState:s,isSubmitting:u}=B(),h=c.useMemo((()=>Array.from(n.values())),[n]),{classes:m}=ee(),p=c.useCallback((({icon:e})=>!0===e.includes("alipay")?o(q,{type:"combined",children:o(D,{className:m.icon})}):o(q,{type:"combined",color:"secondary",src:e})),[]),b=e=>r=>{r.preventDefault(),s(e.id),w.event("select",{category:"order",label:"payment_method",method:n.get(e.id)?.name,method_id:e.id})};return o(T,{title:e("order.checkout.payment-method-card.title"),content:!1,sx:{"& .MuiCardHeader-title.MuiTypography-subtitle1":{color:"red"}},children:o(C,{sx:{p:0},children:r||a?Array.from(new Array(3)).map(((e,r)=>o(L,{disablePadding:!0,divider:!0,children:o(F,{disabled:!0,children:o(A,{children:o(l,{variant:"text",width:100})})})},r))):h.map((e=>o(L,{disablePadding:!0,divider:!0,children:i(F,{selected:d===e.id,disabled:u,onClick:b(e),onTouchEnd:b(e),sx:{backgroundColor:d===e.id?"#3366FF":"transparent","&.Mui-selected":{backgroundColor:"#3366FF",color:"white","&:hover":{backgroundColor:"#3366FF"}},"&:hover":{backgroundColor:d!==e.id?"#f1f1f1":void 0}},children:[e.icon&&o(P,{children:o(p,{icon:e.icon})}),o(A,{children:e.name})]})},e.id)))})})},te=()=>{const{t:e}=t(),{detail:{data:r,isLoading:n},paymentMethodState:d,paymentMethodIndex:s,setSubmitting:u,isSubmitting:h}=B(),[b]=W(),{enqueueSnackbar:g}=a(),f=c.useMemo((()=>[{label:r?.plan.name,value:e("order.checkout.billing-card.price",{value:Number((r?.plan[r?.period]??0)/100).toFixed(2)})},...r?.discount_amount||r?.surplus_amount?[{label:e("order.checkout.billing-card.deduction"),value:e("order.checkout.billing-card.price",{value:(((r?.discount_amount??0)+(r?.surplus_amount??0))/-100).toFixed(2)})}]:[],{label:e("order.checkout.billing-card.total-price"),value:e("order.checkout.billing-card.price",{value:Number((r?.total_amount??0)/100).toFixed(2)})}]),[r,e]),v=c.useCallback((async t=>{if(t.preventDefault(),r&&d)try{u(!0),w.event("click",{category:"order",label:"checkout",method:s.get(d)?.name,method_id:d}),window.location.href=await b({trade_no:r.trade_no,method:d}).unwrap()}catch(a){console.error(a),g(e("notice::checkout-failed"),{variant:"error"}),w.event("click",{category:"order",label:"checkout",method:s.get(d)?.name,method_id:d,success:!1,error:a})}finally{u(!1)}else g(e("notice::data-not-loaded"),{variant:"error"})}),[b,r,d]);return o(T,{title:e("order.checkout.billing-card.title"),children:i(m,{spacing:2,divider:o(_,{}),children:[f.map(((e,r)=>n?o(l,{variant:"text",width:"100%",height:40},r):i(m,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[o(p,{variant:"body1",children:e.label}),o(p,{variant:"body1",children:e.value})]},r))),o(I,{fullWidth:!0,variant:"contained",disabled:n||h,onClick:v,children:e("order.checkout.billing-card.button")})]})})},ae=()=>{const{status:e}=B();return i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:12,children:i(d,{container:!0,spacing:2,children:[e!==U.PENDING&&o(d,{item:!0,xs:12,children:o(K,{})}),o(d,{item:!0,xs:12,md:6,children:o(V,{})}),o(d,{item:!0,xs:12,md:6,children:o(Z,{})})]})}),e===U.PENDING&&o(d,{item:!0,xs:12,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:12,children:o(re,{})}),o(d,{item:!0,xs:12,children:o(te,{})})]})})]})};e("default",(()=>{z("checkout");const e=Y().id;return o(r,{tradeNo:e||"",children:o(ae,{})})}))}}}));
