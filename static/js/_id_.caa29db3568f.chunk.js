import{r as u,a9 as w,n as P,b8 as A,i as p,j as n,T as h,ah as x,bA as L,H as O,af as M,p as R,B as T,bb as j,bd as F,av as N,ai as Y,bN as B,bO as D,bc as Q,aa as $,a7 as q,bh as H,aI as f,bL as W}from"./vendor.7b4e3a5ce4ba.chunk.js";import{q as G,M as E,r as V,j as J,b as K}from"./index.44dd358e3964.js";import{c as U}from"./constate.es.00b696db87ce.chunk.js";import{a as z,g as _,d as X,c as Z}from"./Cancel.8a6379a610d8.chunk.js";import{E as ee}from"./index.es.c6a3932c2db9.chunk.js";import{F as ne,c as te,d as re,a as k}from"./formik.esm.cd9d2689e596.chunk.js";import{a as C}from"./plan.853c03fa5fdd.chunk.js";const ie=({id:t})=>{const e=G(t),[i,c]=u.useState(null),[r,s]=u.useState(!1),[o,a]=u.useState(null);u.useEffect(()=>{e.data&&!i&&c(z(e.data))},[e.data,i]);const d=u.useMemo(()=>{if(!e.data||!i)return-1;const g=_(e.data)[i];return g?g/100:-1},[e.data,i]),m=u.useMemo(()=>o?o.type===1?d-o.value/100:o.type===2?d*(1-o.value/100):-1:d,[o,d]),{enqueueSnackbar:l}=w();return u.useEffect(()=>{e.error&&l(e.error.message,{variant:"error"})},[e.error,l]),{id:t,originPrice:d,price:m,planQuery:e,period:i,setPeriod:c,isSubmitting:r,setIsSubmitting:s,couponCode:o,setCouponCode:a}},[oe,I]=U(ie),ae=()=>{const{t}=P(),{planQuery:{data:e,isLoading:i}}=I(),c=A.useMemo(()=>{try{return console.log("datacontent:",e==null?void 0:e.content),JSON.parse((e==null?void 0:e.content)||"{}")}catch(r){return null}},[e==null?void 0:e.content]);return p(E,{title:t("subscription.plan.plan-info-card.title",{name:e==null?void 0:e.name}),content:!1,children:[!i&&e&&n("div",{children:Array.isArray(c)?c.map((r,s)=>p(h,{variant:"body1",paragraph:!0,component:"div",display:"flex",alignItems:"center",children:[r.support?n(X,{color:"success",style:{marginRight:8}}):n(Z,{color:"error",style:{marginRight:8}}),r.feature]},s)):n(h,{variant:"body1",paragraph:!0,component:"div",children:n(ee,{children:e.content})})}),i&&n(x,{p:2,spacing:1,children:Array.from(new Array(3)).map((r,s)=>n(L,{variant:"text",width:"100%",height:20},s))})]})},ce=()=>{const{t}=P(),{planQuery:{data:e},setPeriod:i,period:c,isSubmitting:r}=I(),s=u.useMemo(()=>e?Object.keys(_(e)):[],[e]);return n(E,{title:t("subscription.plan.period-select-card.title"),content:!1,children:n(O,{sx:{p:0},children:e&&s.map(o=>n(M,{divider:!0,disablePadding:!0,children:n(R,{onClick:a=>{a.preventDefault(),i(o)},selected:o===c,disabled:r,children:p(x,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,width:"100%",py:1.5,children:[n(h,{variant:"subtitle1",children:t("subscription.plan.period-select-card.period",{context:o})}),n(h,{variant:"subtitle1",children:t("subscription.plan.period-select-card.price",{price:((_(e)[o]||0)/100).toFixed(2)})})]})})},o))})})},se=()=>{const{t}=P(),[e,{isLoading:i}]=V(),{setIsSubmitting:c,isSubmitting:r,id:s,setCouponCode:o,couponCode:a}=I();return u.useEffect(()=>{c(i)},[i,c]),n(E,{title:t("subscription.plan.coupon-card.title"),children:n(ne,{initialValues:{coupon:(a==null?void 0:a.code)||""},onSubmit:async(d,{setSubmitting:m,setStatus:l,setErrors:g,setValues:S})=>{if(a){S({coupon:""}),o(null);return}m(!0),await e({code:d.coupon,plan_id:s}).unwrap().then(y=>{o(y),m(!1),l({success:!0})}).catch(y=>{m(!1),l({success:!1}),g(y.errors||{coupon:y.message})})},children:({values:d,handleChange:m,handleSubmit:l,handleBlur:g,errors:S,touched:y})=>p(T,{component:"form",onSubmit:l,children:[n(j,{fullWidth:!0,name:"coupon",placeholder:t("subscription.plan.coupon-card.placeholder").toString(),disabled:r||a!==null,onChange:m,onBlur:g,value:a!==null?a.code:d.coupon,onKeyDown:v=>{v.key==="Enter"&&v.preventDefault()},endAdornment:n(F,{position:"end",children:n(N,{title:t("subscription.plan.coupon-card.tooltip",{context:a!==null?"reset":"add"}).toString(),placement:"bottom",children:n(Y,{edge:"end",type:"submit",children:a!==null?n(B,{}):n(D,{})})})})}),y.coupon&&S.coupon&&n(Q,{error:!0,children:S.coupon})]})})})},de=()=>{const{t}=P(),{planQuery:{data:e},originPrice:i,price:c,couponCode:r,setIsSubmitting:s,isSubmitting:o,period:a}=I(),[d,{isLoading:m}]=J();u.useEffect(()=>{s(m)},[m,s]);const{enqueueSnackbar:l}=w(),g=$(),S=te().shape({plan_id:re().required(t("notice::data-not-loaded").toString()),period:k().oneOf([C.ONETIME,C.MONTHLY,C.QUARTERLY,C.HALF_YEARLY,C.YEARLY,C.TWO_YEARLY,C.RESET_PRICE]).required(t("notice::period-not-selected").toString()),coupon_code:k().nullable()}),y=()=>{const v={plan_id:e==null?void 0:e.id,coupon_code:r==null?void 0:r.code,period:a};S.isValid(v).then(()=>{d({plan_id:v.plan_id,coupon_code:v.coupon_code,period:v.period}).unwrap().then(b=>{console.log("order created:",b),l(t("notice::order-created").toString(),{variant:"success"}),g("/order/".concat(b))}).catch(b=>{console.error(b),l(b.message,{variant:"error"})})}).catch(b=>{console.error(b),l("".concat(b.name,": ").concat(Array.from(b.errors).join(", ")),{variant:"error"})})};return n(E,{title:t("subscription.plan.order-info-card.title"),children:p(x,{spacing:2,divider:n(q,{}),children:[e&&p(x,{direction:"row",justifyContent:"space-between",spacing:1,children:[n(h,{variant:"body1",children:e==null?void 0:e.name}),n(h,{variant:"body1",children:t("subscription.plan.order-info-card.price",{price:i>=0?Number(i).toFixed(2):"0.00"})})]}),r&&p(x,{direction:"row",justifyContent:"space-between",spacing:1,children:[n(h,{variant:"body1",children:t("subscription.plan.order-info-card.coupon",{name:r.name})}),n(h,{variant:"body1",children:t("subscription.plan.order-info-card.price",{price:Number(r.type===1?r.value/100*-1:r.value/100*-1*i).toFixed(2)})})]}),p(x,{direction:"column",spacing:2,children:[n(h,{variant:"subtitle1",children:t("subscription.plan.order-info-card.total")}),n(h,{variant:"h2",component:"span",children:t("subscription.plan.order-info-card.price",{price:c>=0?Number(c).toFixed(2):"0.00"})}),n(H,{fullWidth:!0,variant:"contained",color:"primary",onClick:y,disabled:o,children:t("subscription.plan.order-info-card.button")})]})]})})},le=()=>p(f,{container:!0,spacing:2,children:[n(f,{item:!0,xs:12,md:8,children:p(f,{container:!0,spacing:2,children:[n(f,{item:!0,xs:12,children:n(ae,{})}),n(f,{item:!0,xs:12,children:n(ce,{})})]})}),n(f,{item:!0,xs:12,md:4,children:p(f,{container:!0,spacing:2,children:[n(f,{item:!0,xs:12,children:n(se,{})}),n(f,{item:!0,xs:12,children:n(de,{})})]})})]}),ye=()=>{K("buy-plan");const t=W().id,e=u.useMemo(()=>t&&parseInt(t)||0,[t]);return n(oe,{id:e,children:n(le,{})})};export{ye as default};
