import{r as m,h as re,b9 as ie,aa as te,n as ae,a9 as ne,i as t,F as E,j as e,B as M,aI as n,ah as b,ba as y,an as c,bb as B,bc as w,bd as se,be as oe,bf as le,bi as ce,T as u,l as de,bj as me,bk as pe,bg as $,m as D,bh as G,ao as ue,bl as V,bm as K,bn as H,a$ as L,bo as he}from"./vendor.7b4e3a5ce4ba.chunk.js";import{A as _e}from"./AuthWrapper.adfbe31c739d.chunk.js";import{S as ge,O as we,_ as be,s as fe,a as xe}from"./password-strength.38a8b516907d.chunk.js";import{c as ye,a as v,b as ve,d as z,F as Se}from"./formik.esm.cd9d2689e596.chunk.js";import{c as Ie,d as qe,I as ke,b as Te}from"./index.44dd358e3964.js";import{A as Ae}from"./AnimateButton.aacfc9f9450e.chunk.js";import{u as Pe}from"./useQuery.4ee0c1594054.chunk.js";import"./hey-listen.es.3d38fef0dd76.chunk.js";const Be=()=>{var O;m.useState(!1);const p=re(),S=ie(),I=te(),{t:a}=ae("common"),{enqueueSnackbar:h}=ne(),f=Pe(),[q]=Ie(),{data:r}=qe(),[s,k]=m.useState(),[T,Q]=m.useState(!1),U=()=>{Q(!T)},N=i=>{i.preventDefault()},F=i=>{const l=fe(i);k(xe(l))};m.useEffect(()=>{F("")},[]);const[J,A]=m.useState(!1),[Fe,X]=m.useState(null),[R,P]=m.useState(null),Y=m.useMemo(()=>ye().shape({email:v().email(a("register.email_invalid").toString()).max(255,a("register.email_max",{count:255}).toString()).required(a("register.email_required").toString()),password:v().min(8,a("register.password_min",{count:8}).toString()).max(255,a("register.password_max",{count:255}).toString()).required(a("register.password_required").toString()),password_confirm:v().oneOf([ve("password"),null],a("register.password_confirm_invalid").toString()).required(a("register.password_confirm_required").toString()),invite_code:r!=null&&r.is_invite_force?v().required(a("register.invite_code_required").toString()):v().max(8,a("register.invite_code_max").toString()),email_code:r!=null&&r.is_email_verify?z().required(a("register.email_code_required").toString()):z().negative()}),[a,r==null?void 0:r.is_invite_force,r==null?void 0:r.is_email_verify]),Z=(r==null?void 0:r.email_whitelist_suffix)!=null&&(r==null?void 0:r.email_whitelist_suffix)!=0,j=async(i,l)=>{try{await q({...i,recaptcha_data:l}).unwrap().then(()=>{h(a("notice::register_success"),{variant:"success"}),I("/dashboard",{replace:!0}),L.event("register",{category:"auth",label:"register",method:"email",success:!0,email:i.email,password_strength:s==null?void 0:s.label,invite_code:i.invite_code})}).catch(o=>{S.current&&(P(null),h(o.message,{variant:"error"}),L.event("register",{category:"auth",label:"register",method:"email",success:!1,error:o.message,email:i.email,values:i}))})}catch(o){console.error(o),S.current&&(P(null),h(a("notice::register_failed"),{variant:"error"}))}};return t(E,{children:[e(Se,{initialValues:{email:"",password:"",password_confirm:"",invite_code:(O=f.get("code"))!=null?O:"",email_code:"",agree:!1,submit:null},validationSchema:Y,onSubmit:async(i,{setErrors:l,setStatus:o,setSubmitting:x})=>{if(!i.agree){o({success:!1}),l({submit:a("register.agree_required").toString()}),x(!1);return}(r==null?void 0:r.is_recaptcha)===1?(P({email:i.email,password:i.password,invite_code:i.invite_code,email_code:r!=null&&r.is_email_verify?i.email_code:""}),A(!0),x(!1)):(j({email:i.email,password:i.password,invite_code:i.invite_code,email_code:r!=null&&r.is_email_verify?i.email_code:""},""),x(!1))},children:({errors:i,handleBlur:l,handleChange:o,handleSubmit:x,isSubmitting:W,touched:d,values:g,setValues:C})=>e(M,{component:"form",onSubmit:x,children:t(n,{container:!0,spacing:3,children:[e(n,{item:!0,xs:12,children:t(b,{spacing:1,children:[e(y,{htmlFor:"email",children:e(c,{children:"register.email"})}),e(B,{fullWidth:!0,error:!!(d.email&&i.email),id:"email",type:"email",value:g.email,name:"email",onBlur:l,onChange:o,placeholder:"user@example.com",inputProps:{},endAdornment:(r==null?void 0:r.is_email_verify)===1?e(ge,{email:g.email}):void 0}),Z&&t(w,{error:!0,id:"helper-text-email-signup",children:["仅支持",Array.isArray(r==null?void 0:r.email_whitelist_suffix)?r.email_whitelist_suffix.join(", "):r==null?void 0:r.email_whitelist_suffix,"注册"]}),d.email&&i.email&&e(w,{error:!0,id:"helper-text-email-signup",children:i.email})]})}),(r==null?void 0:r.is_email_verify)===1&&e(E,{children:e(n,{item:!0,xs:12,children:t(b,{spacing:1,children:[e(y,{htmlFor:"email-code-signup",children:e(c,{children:"register.email_code"})}),e(we,{value:g.email_code,onChange:_=>{C(ee=>({...ee,email_code:_}))},numInputs:6,containerStyle:{justifyContent:"space-between"},inputStyle:{width:"100%",margin:"8px",padding:"10px",border:"1px solid ".concat(p.palette.mode==="dark"?p.palette.grey[200]:p.palette.grey[300]),borderRadius:4,":hover":{borderColor:p.palette.primary.main}},focusStyle:{outline:"none",boxShadow:p.customShadows.primary,border:"1px solid ".concat(p.palette.primary.main)}}),d.email_code&&i.email_code&&e(w,{error:!0,id:"helper-text-email-signup",children:i.email_code})]})})}),t(n,{item:!0,xs:12,children:[t(b,{spacing:1,children:[e(y,{htmlFor:"password-signup",children:e(c,{children:"register.password"})}),e(B,{fullWidth:!0,error:!!(d.password&&i.password),id:"password-signup",type:T?"text":"password",value:g.password,name:"password",onBlur:l,onChange:_=>{o(_),F(_.target.value)},autoComplete:"new-password",endAdornment:e(se,{position:"end",children:e(ke,{"aria-label":"toggle password visibility",onClick:U,onMouseDown:N,edge:"end",color:"secondary",children:T?e(oe,{}):e(le,{})})}),placeholder:"******",inputProps:{}}),d.password&&i.password&&e(w,{error:!0,id:"helper-text-password-signup",children:i.password})]}),e(ce,{fullWidth:!0,sx:{mt:2},children:t(n,{container:!0,spacing:2,alignItems:"center",children:[e(n,{item:!0,children:e(M,{sx:{bgcolor:s==null?void 0:s.color,width:85,height:8,borderRadius:"7px"}})}),e(n,{item:!0,children:e(u,{variant:"subtitle1",fontSize:"0.75rem",children:a("register.password_strength",{context:de.lowerCase(s==null?void 0:s.label)}).toString()})})]})})]}),e(n,{item:!0,xs:12,children:t(b,{spacing:1,children:[e(y,{htmlFor:"password-confirm",children:e(c,{children:"register.password_confirm"})}),e(B,{fullWidth:!0,error:!!(d.password_confirm&&i.password_confirm),id:"password-confirm",type:T?"text":"password",value:g.password_confirm,name:"password_confirm",onBlur:l,onChange:_=>{o(_),F(_.target.value)},autoComplete:"new-password",placeholder:"******",inputProps:{}}),d.password_confirm&&i.password_confirm&&e(w,{error:!0,id:"helper-text-password-confirm",children:i.password_confirm})]})}),e(n,{item:!0,xs:12,children:t(b,{spacing:1,children:[e(y,{htmlFor:"invite-code-signup",required:(r==null?void 0:r.is_invite_force)===1,children:e(c,{children:"register.invite_code"})}),e(B,{fullWidth:!0,error:!!(d.invite_code&&i.invite_code),id:"invite-code-signup",type:"text",value:g.invite_code,name:"invite_code",onBlur:l,onChange:o,required:(r==null?void 0:r.is_invite_force)===1,placeholder:a("register.invite_code_placeholder",{context:(r==null?void 0:r.is_invite_force)===1?"required":"optional"}).toString(),inputProps:{},disabled:f.get("code")!==null}),d.invite_code&&i.invite_code&&e(w,{error:!0,id:"helper-text-email-signup",children:i.invite_code})]})}),e(n,{item:!0,xs:12,children:e(me,{value:!1,control:e(pe,{}),name:"agree",id:"agree",onBlur:l,onChange:o,"aria-required":!0,sx:{alignItems:"flex-start"},label:e(u,{variant:"body2",sx:{lineHeight:2.9},children:t(c,{i18nKey:"register.license_agree",children:[e($,{id:"terms-of-service",variant:"subtitle2",component:D,to:"服务协议链接"}),e($,{id:"privacy-policy",variant:"subtitle2",component:D,to:"隐私协议链接"})]})})})}),e(n,{item:!0,xs:12,children:e(Ae,{children:e(G,{disableElevation:!0,disabled:W,fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"primary",children:W?e(ue,{size:24,color:"inherit"}):e(c,{children:"register.submit"})})})})]})})}),(r==null?void 0:r.is_recaptcha)===1&&t(V,{open:J,onClose:()=>A(!1),children:[e(K,{children:e(c,{i18nKey:"auth.captcha.title",children:"Captcha"})}),e(H,{children:e(be,{sitekey:r==null?void 0:r.recaptcha_site_key,onVerify:i=>{X(i),A(!1),R&&(j(R,i),P(null))},onError:()=>{h(a("auth.captcha.error"),{variant:"error"}),A(!1)}})})]})]})},Le=()=>{var a,h,f,q,r,s,k;Te("register");const[p,S]=m.useState(!0),I=()=>{S(!1)};return t(_e,{children:[t(V,{open:p,onClose:I,disableEscapeKeyDown:!0,children:[t(K,{children:[(a=window.config)==null?void 0:a.title,"购前注意与服务条款"]}),t(H,{children:[t(u,{variant:"body1",paragraph:!0,children:[(h=window.config)==null?void 0:h.title,"提供的服务允许用户在 Internet 上建立安全的连接。我们的目的是提高您的在线隐私和安全，但我们不能保证完全的匿名性。"]}),t(u,{variant:"body1",paragraph:!0,children:[e("strong",{children:"禁止非法行为："})," 使用",(f=window.config)==null?void 0:f.title,"的服务从事任何违法活动，包括但不限于 BT 下载、挖矿、邪教、诈骗、发送 SPAM 邮件等都是严格禁止的。",e("br",{}),e("strong",{children:"禁止讨论政治："})," 严禁使用",(q=window.config)==null?void 0:q.title,"的服务讨论、传播或以任何形式参与政治相关的活动或话题，请相关人士请绕道。",e("br",{}),e("br",{}),e("strong",{children:"订阅链接、节点域名和 IP："})," 用户严禁泄露、分享或以任何方式发布与",(r=window.config)==null?void 0:r.title,"服务相关的订阅链接、节点域名或节点 IP 等信息。仅限个人使用，禁止共享给他人使用。"]})]}),e(he,{children:e(G,{onClick:I,color:"primary",children:"我已阅读并同意"})})]}),t(n,{container:!0,spacing:3,children:[t(n,{item:!0,xs:12,container:!0,justifyContent:"center",alignItems:"center",children:[t(u,{color:"red",fontSize:"25px",children:["永久官网: ",(s=window.config)==null?void 0:s.officialWebsite]}),t(u,{children:["当前可用: ",(k=window.config)==null?void 0:k.website]})]}),e(n,{item:!0,xs:12,children:t(b,{direction:"row",justifyContent:"space-between",alignItems:"baseline",sx:{mb:{xs:-.5,sm:.5}},children:[e(u,{variant:"h3",children:e(c,{children:"register.title"})}),e(u,{component:D,to:"/login",variant:"body1",sx:{textDecoration:"none"},color:"primary",children:e(c,{children:"register.go-login"})})]})}),e(n,{item:!0,xs:12,children:e(Be,{})})]})]})};export{Le as default};
